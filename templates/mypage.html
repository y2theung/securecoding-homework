<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ë§ˆì´í˜ì´ì§€</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
  <div class="container mt-4">
    <h1 class="mb-4">ğŸ‘¤ {{ user.nickname or user.username }} ë‹˜ì˜ ë§ˆì´í˜ì´ì§€</h1>

    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        {% for category, message in messages %}
        <div class="alert alert-{{ category }} alert-dismissible fade show" role="alert">
          {{ message }}
          <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="ë‹«ê¸°"></button>
        </div>
        {% endfor %}
      {% endif %}
    {% endwith %}

    {% if error %}
    <div class="alert alert-danger mt-3">{{ error }}</div>
    {% endif %}

    <!-- ë“±ë¡í•œ ìƒí’ˆ -->
    <h3 class="mt-5">ğŸ“¦ ë“±ë¡í•œ ìƒí’ˆ</h3>
    <div class="row">
      {% for product in products %}
      <div class="col-md-4 mb-4">
        <div class="card h-100 shadow-sm">
          <div class="card-body">
            <h5 class="card-title">{{ product.name }}</h5>
            <p class="card-text">{{ product.description }}</p>
            <p class="card-text fw-bold">{{ product.price }}ì›</p>
            <div class="d-flex justify-content-between">
              <a href="/edit_product/{{ product.id }}" class="btn btn-sm btn-outline-primary">ìˆ˜ì •</a>
              <form method="post" action="/delete_product/{{ product.id }}" onsubmit="return confirm('ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?');">
                <button type="submit" class="btn btn-sm btn-outline-danger">ì‚­ì œ</button>
              </form>
            </div>
          </div>
        </div>
      </div>
      {% else %}
      <p>ë“±ë¡í•œ ìƒí’ˆì´ ì—†ìŠµë‹ˆë‹¤.</p>
      {% endfor %}
    </div>

    <!-- ë°›ì€ ìª½ì§€ -->
    <h3 class="mt-5">ğŸ’Œ ë°›ì€ ìª½ì§€</h3>
    <ul class="list-group mb-4">
      {% for msg in inbox %}
      <li class="list-group-item">
        <strong>ë³´ë‚¸ ì‚¬ëŒ ID:</strong> {{ msg.sender_id }}<br>
        <strong>ë‚´ìš©:</strong> {{ msg.content }}<br>
        <small class="text-muted">ë°›ì€ ì‹œê°„: {{ msg.timestamp.strftime('%Y-%m-%d %H:%M') }}</small>
      </li>
      {% else %}
      <li class="list-group-item">ë°›ì€ ìª½ì§€ê°€ ì—†ìŠµë‹ˆë‹¤.</li>
      {% endfor %}
    </ul>

    <!-- ë³´ë‚¸ ìª½ì§€ -->
    <h3 class="mt-5">ğŸ“¤ ë³´ë‚¸ ìª½ì§€</h3>
    <ul class="list-group mb-4">
      {% for msg in sent %}
      <li class="list-group-item">
        <strong>ë°›ëŠ” ì‚¬ëŒ ID:</strong> {{ msg.receiver_id }}<br>
        <strong>ë‚´ìš©:</strong> {{ msg.content }}<br>
        <small class="text-muted">ë³´ë‚¸ ì‹œê°„: {{ msg.timestamp.strftime('%Y-%m-%d %H:%M') }}</small>
      </li>
      {% else %}
      <li class="list-group-item">ë³´ë‚¸ ìª½ì§€ê°€ ì—†ìŠµë‹ˆë‹¤.</li>
      {% endfor %}
    </ul>

    <!-- ì†¡ê¸ˆ ë‚´ì—­ -->
    <h3 class="mt-5">ğŸ’¸ ë³´ë‚¸ ì†¡ê¸ˆ</h3>
    <ul class="list-group mb-4">
      {% for tx in transactions %}
      <li class="list-group-item">
        ìˆ˜ì‹ ì ID: {{ tx.receiver_id }}, ê¸ˆì•¡: {{ tx.amount }}ì›, ë‚ ì§œ: {{ tx.created_at.strftime('%Y-%m-%d') }}
      </li>
      {% else %}
      <li class="list-group-item">ë³´ë‚¸ ì†¡ê¸ˆ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤.</li>
      {% endfor %}
    </ul>

    <!-- ë°›ì€ ì†¡ê¸ˆ ë‚´ì—­ -->
    <h3 class="mt-5">ğŸ“¥ ë°›ì€ ì†¡ê¸ˆ</h3>
    <ul class="list-group mb-4">
      {% for tx in received_transactions %}
      <li class="list-group-item">
        ë³´ë‚¸ ì‚¬ëŒ: {{ tx.sender.nickname or tx.sender.username }}<br>
        ê¸ˆì•¡: {{ tx.amount }}ì›<br>
        ë‚ ì§œ: {{ tx.created_at.strftime('%Y-%m-%d') }}
      </li>
      {% else %}
      <li class="list-group-item">ë°›ì€ ì†¡ê¸ˆì´ ì—†ìŠµë‹ˆë‹¤.</li>
      {% endfor %}
    </ul>

    <!-- ê°œì¸ì •ë³´ ë³€ê²½ -->
    <h3 class="mt-5">ğŸ” ê°œì¸ì •ë³´ ë³€ê²½</h3>
    <form method="post" class="mt-3">
      <div class="mb-3">
        <label for="nickname" class="form-label">ë‹‰ë„¤ì„</label>
        <input type="text" class="form-control" name="nickname" value="{{ user.nickname or '' }}">
      </div>
      <div class="mb-3">
        <label for="bio" class="form-label">ìê¸°ì†Œê°œ</label>
        <input type="text" class="form-control" name="bio" value="{{ user.bio or '' }}">
      </div>

      <hr>
      <h5 class="mb-3">ë¹„ë°€ë²ˆí˜¸ ë³€ê²½</h5>
      <div class="mb-3">
        <label for="current_password" class="form-label">í˜„ì¬ ë¹„ë°€ë²ˆí˜¸</label>
        <input type="password" class="form-control" name="current_password" required>
      </div>
      <div class="mb-3">
        <label for="new_password" class="form-label">ìƒˆ ë¹„ë°€ë²ˆí˜¸</label>
        <input type="password" class="form-control" name="new_password">
      </div>

      <button type="submit" class="btn btn-success">ìˆ˜ì •í•˜ê¸°</button>
    </form>
  </div>
</body>
</html>
